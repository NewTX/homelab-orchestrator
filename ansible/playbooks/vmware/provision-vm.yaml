---
- name: create vm Playbook
  hosts: localhost
  become: false
  gather_facts: true
  vars_files:
    - ../../vars/common.vault.yaml
  environment:
    VMWARE_HOST: '{{ vcenter.hostname }}'
    VMWARE_USER: '{{ vcenter.admin_username }}'
    VMWARE_PASSWORD: '{{ vcenter.admin_password }}'
    VMWARE_VALIDATE_CERTS: 'false'
  tasks:
    - name: Provision VM
      ansible.builtin.include_role:
        name: ../../roles/provision-vm
      vars:
        vm_name: '{{item.name}}'
        vm_ip: '{{item.ip}}'
      loop: '{{ vm_list | from_json }}'
      loop_control:
        loop_var: item
